## 안정적인 서비스 배포를 위한 배포 전략
서비스를 운영하다보면 새로운 기능을 추가하거나 버그를 수정해야 한다  
하지만 코드를 반영하기 위해 서버를 내리거나 배포한 코드에 치명적인 버그가 있어 사용자들이 영향받는건 안된다  
따라서 이러한 문제를 해결하기 위해 다양한 배포 전략이 생겼다  

기본적으로 모든 배포는 무중단 배포가 기본 전제

### 롤링 배포
계단을 오르듯 `서버를 순차적으로 교체`하는 방식

```
[시작] 서버 A, B, C, D 모두 v1.0

[1단계] 서버 A → v2.0 (나머지는 v1.0)
[2단계] 서버 B → v2.0 (A, B는 v2.0 / C, D는 v1.0)
[3단계] 서버 C → v2.0 
[4단계] 서버 D → v2.0

[완료] 모든 서버가 v2.0
```

+ 장점
    - 다운타임 없음 : 항상 일부 서버가 운영 중
    - 리소스 효율적 : 기존 서버만으로 배포가 가능 (추가 서버 불필요)
+ 단점
    - 롤백이 복잡함 : 배포 중 문제가 발생하면 역순으로 하나씩 되돌려야 함
    - 버전이 혼재함 : 배포 중 v1.0과 v2.0이 동시에 서비스

### 블루그린 배포
두개의 동일한 환경을 준비하고 한쪽에 배포가 끝난 후, `스위치를 전환`하듯 한번에 바꾸는 방식

```
[블루 환경] 서버 A, B (v1.0) ← 현재 운영 중, 트래픽 100%
[그린 환경] 서버 C, D (v2.0) ← 대기 중, 트래픽 0%

[배포 시점]
로드밸런서 스위치를 그린으로 전환!

[블루 환경] 서버 A, B (v1.0) ← 대기 상태
[그린 환경] 서버 C, D (v2.0) ← 운영 중, 트래픽 100%
```

+ 장점
    - 즉각적인 롤백이 가능 : 문제 발생하면 스위치만 다시 블루로 변경하여 쉬운 롤백
    - 완전한 테스트 가능 : 그린 환경에서 충분히 테스트 후 전환
    - 버전 혼재 없음 : 한번에 완전한 전환
+ 단점
    - 리소스 2배 필요 : 동일한 환경을 2세트 유지해야 함
    - 데이터베이스 동기화 : DB 스키마 변경시 블루, 그린 모두 고려해야 함

### 카나리 배포
`소수의 사용자에게만 먼저 새 버전을 제공`하고 문제가 없으면 점진적으로 확대하는 방식

```
[1단계] v2.0 트래픽 5% → 소수 사용자로 테스트
[2단계] v2.0 트래픽 25% → 문제 없으면 확대
[3단계] v2.0 트래픽 50%
[4단계] v2.0 트래픽 100% → 완전 전환
```

+ 장점
    - 리스크 최소화 : 문제가 발생해도 소수만 영향
    - 실 사용자의 피드백 : 실제 프로덕션 환경에서 검증
    - 점진적 확대 : 모니터링하면서 단계적으로 늘릴 수 있음
+ 단점
    - 배포시간이 길다 : 단계적으로 진행하므로
    - 모니터링 필수 : 각 단계마다 메트릭 확인 필요
    - 복잡도 증가 : 트래픽 분산 로직 필요