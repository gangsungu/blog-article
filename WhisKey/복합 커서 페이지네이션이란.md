## 복합 커서 페이지네이션이란
복합 커서 페이지네이션은 `여러 컬럼을 조합해서 정렬`할때 사용하는 방식

### 왜 복합 커서가 필요하지?
실무에서는 단순히 PK로 정렬하는 경우가 드물다  

```
"최신순으로 보여주되, 같은 시간에 작성된 글이면 id 순으로"
"가격순으로 보여주되, 같은 가격이면 평점이 높은 순으로"
```

단일 커서로는 이런 복합 정렬을 제대로 처리할 수 없다  

```sql
-- created_at으로만 정렬
SELECT * FROM posts 
WHERE created_at < '2024-01-15 10:00:00'
ORDER BY created_at DESC 
LIMIT 10;
```
+ created_at에 같은 값이 여러개면 순서가 불안정해져 같은 쿼리를 반복하면 순서가 바뀔 수 있다

### 복합 커서의 기본 원리
+ 복합 정렬 조건
    ```sql
    -- created_at DESC, id DESC로 정렬
    SELECT id, created_at, title 
    FROM posts 
    ORDER BY created_at DESC, id DESC 
    LIMIT 10;

    -- 결과
    id=105, created_at='2024-01-15 10:00:00'
    id=104, created_at='2024-01-15 10:00:00'  -- 같은 시간
    id=103, created_at='2024-01-15 09:50:00'
    ...
    ```
+ WHERE 조건이 복잡성
    ```sql
    -- 잘못된 방법
    WHERE created_at < '2024-01-15 10:00:00'

    -- id=105를 커서로 했는데, id=104가 누락됨! (같은 created_at)
    ```

### 인덱스 최적화
복합 커서는 `복합 인덱스`가 필수  
복합 커서를 구성할 때, 선택도를 고려해서 순서를 정해야한다

```sql
-- 단일 인덱스로는 비효율적
CREATE INDEX idx_created ON posts(created_at);
CREATE INDEX idx_id ON posts(id);

-- 복합 인덱스 필요 (정렬 순서와 동일하게!)
CREATE INDEX idx_posts_cursor ON posts(created_at DESC, id DESC);

-- 3개 컬럼이면
CREATE INDEX idx_posts_complex ON posts(like_count DESC, created_at DESC, id DESC);
```